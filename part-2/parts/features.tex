\chapter{Features}\label{chap:features}

\input{parts/features/notifications-comments}

\input{parts/features/fragments}

\section{User avatar}
With the ''User avatar'' the user has the possibility to upload a picture to his own profile. Through the function \textit{Profil edititieren}  the user can get to the \textit{Profil editieren} form. 
\pagebreak

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/profil_editieren.png}
  }
  \caption{edit profile}
  \label{fig:profil_editieren}
\end{figure}

The uploader in this form allows the user to upload a picture as his avatar.

\pagebreak

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/profil_editieren_uploader.png}
  }
  \caption{profile avatar uploader}
  \label{fig:profil_editieren_uploader}
\end{figure}

\pagebreak

After the avatar picture is uploaded the profile picture will be changed.

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/profil_editieren_avatar.png}
  }
  \caption{profile avatar picture}
  \label{fig:profil_editieren_avatar}
\end{figure}


\input{parts/features/avatar}

\input{parts/features/plagiarism-webservices}

\input{parts/features/permissions-and-roles}

\input{parts/features/barcode}

\pagebreak

\section{Report}

The report is needed to collect and document all the found plagiarized fragments of the reviewed document. It will be used as an evidence to proof (major) plagiarism.
The report documents all founded plagiarized parts including their corresponding sources.

The report has also a barcode on the first page to give the reader a quick visuell overview to the plagiarism level of the reviewed document.

Below you can read about the generation of a report, a short description of the development and the outlook of an example of a report.

\subsection{Generation of a report}

To generate a report it is neccessary that there exist approved fragments for this case. Without approved fragments in a case it is not possible to generate a report for this case. 
This is made to have only approved fragments listed in the report. This makes sure that only real plagiarized text parts are listed in the report.

To generate a report the user needs to choose the tab \textit{Berichte} and than clicks at the button \textit{Bericht erstellen}. After the user clicked at the  button \textit{Bericht erstellen}, he has the possibility to fill up the report form to give the title of the report and to give some evaluations about the reviewed document.

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/report_form.jpg}
  }
  \caption{report form}
  \label{fig:report_form}
\end{figure}

\pagebreak

After saving the form, the report will be generated and will be listed.

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/report_list.png}
  }
  \caption{example of a listed report}
  \label{fig:report_list}
\end{figure}

\subsection{The developing of the report function}

Before starting to develope the report function, it was necessary to make researches about PDF's generation frameworks. After some researches and hints from Unplagged's group members the decision felt to \textit{dompdf}. 

\subsubsection{dompdf}

 \href{http://code.google.com/p/dompdf/}{dompdf} is an easy to use framework which gives users the posibility to generate PDF files dynamically. After the familiarisation phase, it was not difficult to use this framework to generate the first report in PDF form. But \textit{dompdf} had problems with pagebreaks. The reasons were for example that it could not handle it if the content between two \textit{div tags} or a \textit{table cell} was longer than one page.
And there was another big disadvantage of \textit{dompdf}, it was not possible to represent the fragments in column format. It was only possible to show the fragments among one another in the generated report. It was a known problem of \textit{dompdf}.

After a lot of tryings to code workarounds and researches in forums, it was obvious that there was no way to make the column representing what we needed for the fragments view or what will be shown in the report, with the \textit{dompdf} framework. At the end we had to make that not easy decision to pass on \textit{dompdf} and to find another framework that suits our needs better.
So we had to research again. But this time we knew better what we were searching for - First of all a framework which can handle column representation.

Because of this and some other reasons the report generating framework \textit{HTML2PDF} was used.

\subsubsection{HTML2PDF}

\href{http://html2fpdf.sourceforge.net/}{HTML2PDF} is the framework chosen for the report generation. The big advantage of \textit{HTML2PDF} is that it is possible to show the fragments in column format. Another big advantage is that with \textit{HTML2PDF} it is possible to add SVG code to the HTML content and therefore we were able to include it to the generated PDF file. The possibility of adding SVG was necessary because we could add the barcode, which was generated as SVG, to the report .

For the barcode generation of the report the following code was used.

\begin{lstlisting}[caption=Generating the barcode for the report]
  private function getBarCode($case) {
        $str_svg = $case->getBarcode(80, 150, 100, false, '%')->render();
        $str_svg = str_replace('svg', 'draw', $str_svg);
        $str_svg = str_replace('width=', 'w=', $str_svg);
        $str_svg = str_replace('height=', 'h=', $str_svg);

        return "<h2>Barcode</h2>" . $str_svg;
    }
\end{lstlisting}

The page number was written in the footer. The page number was generated with the following code.

\begin{lstlisting}[caption=Generating the pagenumbers]
    private function getFooter($pagenumber) {
        return "<page_footer>" . $pagenumber . "/%pagenumber%</page_footer> ";
    }
\end{lstlisting}

The \textit{HTML2PDF} class' call is shown below.

\begin{lstlisting}[caption=Use of the class html2pdf]
        $html2pdf = new HTML2PDF('P', 'A4', 'en');
        $html2pdf->WriteHTML($content);
\end{lstlisting}

The following code was a workaround. This workaround was necessary because \textit{HTML2PDF} had also pagebreak problems as \textit{dompdf}. This problem was not so easy to solve as we thought at the beginning. The problem was that  \textit{HTML2PDF} needs always proper and valid HTML content to generate the PDF file. Valid HTML content means that all HTML tags need to be closed. 

For example, \textit{span}-tags were used for the coloured simtext passages. This \textit{span}-tag contained the plagiarized text. If the content of the \textit{span}-tags were seperated in two or more pages, the \textit{span}-tag could not be closed within one page. This means it was for \textit{HTML2PDF} not a valid HTML anymore and \textit{HTML2PDF} refused to generate the PDF file.

The workaround limited 400 words, that was the number of words which could be written in one page. So that if there was a \textit{span}-tag which was not closed in a page, it would be closed with the following code.

\begin{lstlisting}[caption=Workaround for the \textit{html2pdf} pagebreak problem]
   /**
     * Removes the multiple blank spaces from the given parameter.
     */
    private function remove_spaces($text) {
        while (true) {
            $replaced = str_replace('  ', ' ', $text);
            if ($replaced != $text) {
                $text = $replaced;
            } else {
                break;
            }
        }
        return $text;
    }

 /**
     * Cuts the given text into an array, which each element contains
     * $nbWordsProPage words.
     */
    private function cut_text_into_pages($text) {
        $text = $this->remove_spaces($text);
        $exploded = array_slice(explode(' ', $text), 0);
        $nbWordsProPage = 400;
        $nbPage = 0;
        $pages = array();
        $rest = "";
        $nbRest = 0;

        for ($i = 0; $i < sizeof($exploded); $i+=$nbWordsProPage) {
            $page = $rest . implode(' ', array_slice($exploded, $i, $nbWordsProPage - $nbRest));
            $result = $this->check($page);
            $rest = $result["toRetrieve"] . " ";
            $nbRest = str_word_count($rest);
            $pages[$nbPage++] = $result["s"];
        }

        return $pages;
    }

    private function result($length, $s) {
        $array = array();
        $array["toRetrieve"] = substr($s, $length, strlen($s) - $length);
        $array["s"] = substr($s, 0, $length);
        $array["original"] = $s;
        return $array;
    }

    private function check($s) {
        $nbST = substr_count($s, ST);
        $nbBT = substr_count($s, GT);
        if ($nbST == $nbBT) {
            $nbSpanOpen = substr_count($s, SPAN_OPEN);
            $nbSpanClose = substr_count($s, SPAN_CLOSE);
            if ($nbSpanOpen == $nbSpanClose) {
                return $this->result(strlen($s), $s);
            } else {
                // 'halli hallo <span>'
                return $this->result(strrpos($s, SPAN_OPEN), $s);
            }
        } else {
            // one tag is not closed
            //'halli hallofff <span></span'
            //'halli hallofff <span'
            $nbSpanOpen = substr_count($s, SPAN_OPEN);
            $nbSpanClose = substr_count($s, SPAN_CLOSE);

            return $this->result(strrpos($s, SPAN_OPEN), $s);
        }
    }
\end{lstlisting}

\subsection{Outlook of a report}

The report had besides its first page three further parts: The default text with the evaluation text, the list of approved fragments and the references to the corresponding sources.

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/report_deckblatt.png}
  }
  \caption{example of a first page of a report}
  \label{fig:report_deckblatt}
\end{figure}

\pagebreak

The default text contained evaluation text. The evaluation text was individual text which was given from the person, who generated the report, through the report modify form.
\pagebreak

Below there is an example of the default text.

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/report_default_evaluation_text.jpg}
  }
  \caption{report defaulttext}
  \label{fig:report_default_evaluation_tex}
\end{figure}
\pagebreak

After the evaluation text, the list of approved fragments will be shown.  (see figure \ref{fig:report_fragment})

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/report_fragment.png}
  }
  \caption{example of a listed approved fragment}
  \label{fig:report_fragment}
\end{figure}

\pagebreak
At the end, all the references to the found sources are mentioned.

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/report_according_sources.jpg}
  }
  \caption{example of a listed source}
  \label{fig:report_according_sources}
\end{figure}

\section{Simtext}
Simtext is a common name about a tool which helps to check for text similarity between two inputs. This tool uses a complex algorithm to compare the inputs. The result of the comparison is an output which should contain similar text passages between the two inputs and the positions of the similar text passages on the documents. 

There are many softwares for text similarity tester, but at the beginning of the development for simtext in our workbench, we used the software SIM of Dick Grune. This software is free and the result after the comparison process is reliable. We integrated this software to Unplagged but there were some disadvantages about this software. Then we saw that the Vroniplag community had developed a simtext tool, which was also based on SIM, but cleverly modified in Javascript. This version was quite simplified and optimized for web browser. We wanted to adapt this Javascript version in our workbench as well, but unfortunately it was not that easy to integrate it. The reason was that some of its functions were not suitable in our environment at all. Therefore we decided to modify this Javascript version in PHP. 

Here are some descriptions about the development and improvement of the simtext tool for our workbench.

\subsection{SIM in C - Original version}
The program was developed by Dick Grune. It was written in C and runnable in other languages like Java, Pascal etc. and had a quite complicated structure.

''The general outline of the similarity checker is as follows:  \footnote{ftp://ftp.cs.vu.nl/pub/dick/similarity\_tester/TechnReport}


\begin{enumerate}
\item the files are read in (pass 1)
\item a forward-reference table is prepared
\item the set of interesting runs is determined
\item the line numbers of the runs are determined (pass 2)
\item the contents of the runs are printed in order (pass 3)''
\end{enumerate}


The result of the comparison process was a plain text file which showed the similar text passages and the positions, where the plagiarized text was similar with the source text.

We integrated this software into our workbench, but because it was not specifically developed for the web, there were some disadvantages of this software. They are:

\begin{itemize}
\item it was complicated to run the program  - It had to be compiled through the C command 
\item input/output were plain text files
\item there was no color for marking the similar text passages
\item only similar text passages were shown, not the whole documents
\item the result was simple, monotone and not impressive
\item In order to compare HTML texts or other file types, it  was maybe needed to parse the inputs in plain text files. After comparing, the result as plain text file should be parsed again in HTML so that it can be shown in the browser. Therefore the comparison process was complicated and the speed could be decreased if there were a lot of documents.
\end{itemize}

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/SIM_Dick_Grune.png}
  }
  \caption{Simtext in C}
  \label{fig:Sim_in_C}
\end{figure}

\subsection{Vroniplag’s Javascript version}
We found out that Vroniplag also had its own text comparison tool, which was written in JavaScript. According to the author, this web-based version was also based on the original version of Dick Grune.\footnote{http://de.vroniplag.wikia.com/wiki/Benutzer:Marcusb/Farbige\_Fragmente}

The Javascript version could compare two fragments, it finds out the similar text passages and marks them with different colors. A text passage is defined by default as a phrase which is more than 4 tokens (words) long.

We thought this version was more flexible. Besides the text comparison function, it was also possible to mark the similar text passages with different colors. This could help the user get a better overview about the result. Because it was written in Javascript, it could also read the HTML texts and compare them directly without the parsing process as in the SIM version above. In addition, there was a button which could be switched on/off to show/hide the colors.

But when we tried to adapt this version to our workbench, there were some difficulties that we thought the adaptation was too complicated. The difficulties were:
\begin{itemize}
\item Because Vroniplag is a Wiki-Community, so the version was written and adjusted to this Wiki’s environment. That means, the author has customized the version so that it fit to the Wiki page’s attributes. There were a lot of the author’s improvements and changes of relative functions only for the purpose that it could work in Wiki. Therefore it was not easy to adapt the version again in our workbench, because we did not have the suitable conditions as by Wiki
\item If the user does not have/want Javascript turned-on on the browser, it would be difficult to see the colored result of the text comparison tool
\item We wanted to make our own thing
\end{itemize}

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/vroni_farbfrag.png}
  }
  \caption{Vroniplag Colored Fragments}
  \label{fig:Vroniplag_Colored_Fragments}
\end{figure}

\subsection{Unplagged’s PHP version}
After considering advantages and disadvantages of the two versions, we decided to modify the Javascript version in PHP language. Because of the disadvantage of the Wiki’s environment, we took only the main part of the Javascript version - the text compare function - and tried to modify it to our workbench.

\input{parts/features/sim-text-function}

\input{parts/features/disadvantages-sim-text-function}

\input{parts/features/colors-sim-text-function}

\subsection{Uses of text comparison function in Unplagged}
The function text comparison was an important feature which was used much in many different sections in our workbench.

\input{parts/features/fragment-form-simtext}

\input{parts/features/fragment-show-simtext}

\input{parts/features/many-docu-simtext}

\pagebreak

\section{Bibtex Metadata}

Bibtex function was another feature in our workbench. Based on VroniPlag, Bibtex was created to provide the user an overview of the document's bibliographic information. The user had the possibility to add the bibtex information of a document through the document modify form when he created a new document. 

In the document modify form there was an extra section for bibtex information. In this section, the bibtex modify form was first shown in its full form. There were over 20 fields in it. All of the fields were taken from VroniPlag. The fields \textit{Author} and \textit{Title} must be filled, the field \textit{Year} could be filled as \textit{o.J (ohne Jahrgang)} if it was unknown.

\pagebreak

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/bib_full.png}
  }
  \caption{Bibtex full form}
  \label{fig:Bibtex_full_form}
\end{figure}

If the user wanted to specify a type for his document, there were also 3 separated subforms available:

\begin{itemize}

\item book

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/bib_book.png}
  }
  \caption{Bibtex book form}
  \label{fig:Bibtex_book_form}
\end{figure}

\pagebreak

\item periodical 

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/bib_periodical.png}
  }
  \caption{Bibtex periodical form}
  \label{fig:Bibtex_periodical_form}
\end{figure}

\pagebreak

\item essay

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/bib_essay.png}
  }
  \caption{Bibtex essay form}
  \label{fig:Bibtex_essay_form}
\end{figure}

\end{itemize}

After saving bibtex information, the user could see it again by the tab Bibliography in Unplagged. In the Bibliography section, a list of all the documents with their bibtex information are shown (see figure \ref{fig:Bibliography_list}). If the user would like to change something, he could choose the action button to come back to the document modify form.

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/bib_list.png}
  }
  \caption{Bibliography list}
  \label{fig:Bibliography_list}
\end{figure}

If the user clicked on a bibtex link, he could see the details of the bibtex information of the document. More especially, to give the user an overview, that which fragments belong to this bibtex, a list of those fragments with the comparison and colors would also be shown here  (see figure \ref{fig:Bibliography_frag_view}).

\begin{figure}[!h]
  \centering
  \fbox{
    \includegraphics[width=0.97\textwidth]{images/bib_frag_view.png}
  }
  \caption{view of bibtex information with fragments belong to it}
  \label{fig:Bibliography_frag_view}
\end{figure}
